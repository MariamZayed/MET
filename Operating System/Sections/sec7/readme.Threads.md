<p dir="rtl">

# ๐ **Session 7 โ Multithreading Session**

## Table of Contents

* 1- Thread
* 2- Benefits of Multithreading
* 3- Multicore Programming Challenges
* 4- Multithreading Models 
* 5- Implicit and Explicit Threading
* 6- Thread Cancellation 
---

## **1. Introduction to Thread**

ุงูู **Thread** ูู ุฃุตุบุฑ ูุญุฏุฉ ุชูููุฐ ุฏุงุฎู ุงูู **Process**.
ุงูุชุนุฑูู: single sequence of excution
ุงูู Process ูููู ูุญุชูู ูุฐุง Thread ูููู ุจูุดุงุฑููุง ููุณ ุงูู **address space** ูููุณ ุงูู **resources**ุ ูุฏู ุจูุณูุญ ุจุชูููุฐ **parallelism** ุฃู **concurrency**.

---
## **2. Benefits of Thread**

### **2.1.1 Why Threads Are Better Than Processes**

ุฑุบู ุฅู ุงูู **Processes** ูููุฉ ููุณุชููุฉุ ููู ุงูู **Threads** ุฃุญุณู ูู ุญุงุฌุงุช ูุชูุฑ:

* ุงูุชูุงุตู ุจูู ุงูู Threads ุฃุณูู ูุฃุณุฑุน ูุฃููุง ุจุชุดุงุฑู ููุณ ุงูู **address space**ุ ููู ุงูู Processes ุจุชุญุชุงุฌ **IPC (Inter-Process Communication)** ูุฏู ุฃุจุทุฃ ููุนูุฏ.
* ุงูู Process ููู **PCB (Process Control Block)** ูุจูุฑ ููู ูู ุญุงุฌุฉ ุชุฎุตูุ ุจูููุง ุงูู Thread ููู TCB ุตุบูุฑ ูุฎูููุ ูุงูุชุนุงูู ูุนุงู ุฃุณุฑุน.
* ุงูู Context Switching ุจูู Threads ุฃุฎู ูู ุงูู Switching ุจูู Processes.
ููููุง 4 ููุงูุฏ ูุดููุฑู

### **2.1 Responsiveness**

ูุฌูุฏ ุฃูุชุฑ ูู Thread ุจูุฎูู ุงูุจุฑูุงูุฌ ููุถู ุดุบุงู ุญุชู ูู ููู thread ุชุงูู ุจูุนูู ุดุบู ุชููู, ูุญู ูู ุซุฑูุฏ ุญุตููุง ุจููู, ุงููููุดู ูููุง ูุด ูุชูู, ูุงููุง ูุงุณูู ูุฑุน ุตุบูุฑ (ุนูุณ ุงูุจุฑูุณูุณ)
ููุญูุธุฉ, ุงุญูุง ูุณู ุดุบุงููู ุจุงูุชูุงุฒู


### **2.2 Resource Sharing**

ุงูู Threads ุฏุงุฎู ููุณ ุงูู Process ุจูุดุงุฑููุง:

* ููุณ ุงูู memory
* ููุณ ุงูู code
* ููุณ ุงูู data

ูุฏู ุจูุฎููู ุชุจุงุฏู ุงูุจูุงูุงุช ุฃุณูู ูู ุงูู **Processes** ุงููู ุจุชุญุชุงุฌ **IPC โ Inter-Process Communication**.

### **2.3 Economy (Lightweight Execution)**

ุฅูุดุงุก Thread ุฃุฑุฎุต ุจูุชูุฑ ูู ุฅูุดุงุก Process ูุฃู ุงูู Thread ูุด ุจูุนูู:

* new memory allocation
* copying PCB
* ููุด ุจูุนูู ุฅูุดุงุก address space ุฌุฏูุฏุฉ

ุนุดุงู ูุฏู ุจูููู ุฅู ุงูู Threads **Lightweight**.

---

### **2.3.1 Why Threads Donโt Allocate New Address Space**

ุงูู **Thread** ุฌุฒุก ูู ุงูู **Process**ุ ูุด ููุงู ูุณุชูู.
ูุนุดุงู ูุฏู:

* ูู Threads ุฌูู ููุณ ุงูู Process ุจูุณุชุฎุฏููุง **ููุณ ุงูู address space** ุงููู ุงุชุนููุช ููู Process ุงูุฃุตูู.
* ูู ูู Thread ูุงู ููุนูู address space ููุญุฏูุ ูุจูู ูู ูุฏู Process ุฌุฏูุฏ ูุด Thread.
* ูุฏู ุงูู Thread ุฃุตูุงู ุฅูู ูููู "lightweight" ููุดุงุฑู ุงูู resources ุจุฏู ูุง ูุนูุฏ ุชูููููุง.

ูุงููุนุงูุฌ ูุง ุจูุฎุตุตููุด Memory ุฌุฏูุฏุฉโฆ ุจูุงุฎุฏ ูู ููุณ ูุณุงุญุฉ ุงูู Process.

---
### **2.4 Utilization of Multiprocessor Architectures**

ุงูู Multicore CPU ุจููุฏุฑ ูุดุบูู ุฃูุชุฑ ูู Thread ูู ููุณ ุงูููุช ุนูู Cores ูุฎุชููุฉ โ ุฃุฏุงุก ุฃุนูู ุจูุชูุฑ.


#### ุฅูู ุงููุฑู ุจูู Multicore vs Multiprocessorุ

ุงูููุทุฉ ุฏู ููุฌูุฏุฉ ูุฃููุง ุจุชุดุฑุญ **ุฃูุจุฑ ูุงุฆุฏุฉ ููู Multithreading**:
ุฅูู ุชูุฏุฑ ุชุณุชุบู ูู Core ูู ุงููุนุงูุฌ ุจุฏู ูุง ุชูููุฐ ูู ุญุงุฌุฉ ุจุงูุชุณูุณู.

ุงููุนุงูุฌ ุงููู ููู ุฃูุชุฑ ูู Core ููุฏุฑ ูุดุบูู ุฃูุชุฑ ูู Thread **ูู ููุณ ุงููุญุธุฉ** (Parallelism).
ูุฏู ุฃูู ุณุจุจ ูุนูู Multithreading ุฃุตูุงู.

| ุงููุตุทูุญ                   | ุงููุนูู                                              | ูุซุงู                        |
| ------------------------- | --------------------------------------------------- | --------------------------- |
| **Multicore Processor**   | ูุนุงูุฌ ูุงุญุฏ ููู **ุฃูุชุฑ ูู Core** ููู ูู ุดุฑูุญุฉ ูุงุญุฏุฉ  | Core i7 Quad-Core           |
| **Multiprocessor System** | ุฌูุงุฒ ููู **ุฃูุชุฑ ูู ูุนุงูุฌ ูุณุชูู** (ุฃูุชุฑ ูู CPU ูุนูู) | Servers ูููุง 2 ุฃู 4 ูุนุงูุฌุงุช |

**ุจุงุฎุชุตุงุฑ:**
Multicore = Processor ูุงุญุฏ ุจูุฐุง Core
Multiprocessor = ุฌูุงุฒ ููู ุฃูุซุฑ ูู Processor

ูุงูู Threads ุชุดุชุบู ุนูู ุงูุงุชูููุ ุจุณ ุงูู Multicore ูู ุงููู ููุชุดุฑ ูู ุงููุงุจุชูุจุงุช.

---

## **3. Multicore Programming Challenges**

### **3.1 Challenges of Multicore Programming**

#### **3.1.1 Identifying Tasks**

ูุงุฒู ููุณู ุงูุจุฑูุงูุฌ ุงู ุงูุจุฑูุฌุฑุงู ู tasks ูุฌุฒุก ูููุน ูุชูููุฐ ูู Thread ูุณุชูู.

#### **3.1.2 Balance**

ูุงุฒู ููุฒูุน ุงูููุงู ุจุญูุซ ูููุด Core ุชุจูู ูุญูููุฉ ุฒูุงุฏุฉ ุนู ุงููุฒูู.
Ensure each thread performs equal work, equal value.

>##### **3.1.1 Load Balancing Criteria**

> ุงูุชูุฒูุน ูุด ุญุณุจ ุงูููุช ููุง ุงูุญุฌู ุจุณโฆ ูู ูุฒูุฌ ูู:
>
> 1. **Workload amount**
>
>    > ูููุฉ ุงูุดุบู ุงููู ุงูู Thread ูุญุชุงุฌ ูุนูููุง (Computation).
> 2. **Thread priority**
>
>    > ูู ูู Threads ุฃูู ูู ุบูุฑูุง.
> 3. **Core availability**
>
>    > ูู ูู Core ูุงุถูุฉ ุฃู ุนูููุง ุถุบุท ุฃูู.
> 4. **Execution time**
>
>    > ูู Thread ุจุชุงุฎุฏ ููุช ุทูููุ ูููู ูุญุท ูุนุงูุง Thread ุฎูููุฉ.
>
> ุงููุฏู ุงูููุงุฆูุ
>
> > ููุง Core ุชุจูู **Overloaded** ูุงูุจุงูู ูุงุถู.
> > ุนุดุงู ุฏู ูุณุจุจ **performance drop**.
.
<br>
<br>
#### **3.2.3 Data Splitting**

ุงูุจูุงูุงุช ุงููุดุชุฑูุฉ ุจูู ุงูู Threads ูุงุฒู ุชุชูุณูู ุตุญ, ุจุญูุซ ูุญุฏุด ูุนุฏู ุนูู ุญุงุฌู ุจุชุงุนุช ุงูุซุฑูุฏ ุงูุชุงููู ุงู ุชูุฑุง ูุจู ุงูุงููุง.

>##### **3.2.3.1 Why Data Splitting Is a Challenge**

> ููุง Threads ุชุดุงุฑู ููุณ ุงูุจูุงูุงุช:
>
> > ูุงุฒู ุชูุณู ุงูุจูุงูุงุช ุจุญูุซ ูู Thread ูุดุชุบู ุนูู ุฌุฒุก ูุงุถุญ.
> > ููููุน Thread ุชููุณ Data Thread ุชุงูู ูู ุบูุฑ ุชูุธูู.
> > ูู ุงูุชูุณูู ุบูุท โ ูุญุตู ุชุถุงุฑุจุ ููุธูุฑ **race condition**.
>
> ูุนูู ูู ุนูุฏู Arrayุ ููุด ููุณูุงู ุตุญ:
>
> > Thread ูููู ุชูุชุจ ููู ุจูุงูุงุช Thread ุชุงูู โ ุงูุจุฑูุงูุฌ ูุจูุธ.

---
<br><br>

#### **3.2.4 Testing and Debugging**

ุงูุจุฑุงูุฌ ุงููู ูููุง multithreading ุฃุตุนุจ ูู ุงูุงุฎุชุจุงุฑ ูุจุชุณุจุจ ูุดุงูู ุฒู **race conditions**.
>#### **3.2.4.1 Why Multithreading Makes Testing Hard**

> ุงููุดุงูู ููุง ูุด ุจุณุจุจ ุงูู threads ููุณูุงุ ููู ุจุณุจุจ **ุงูุณููู ุบูุฑ ุงููุชููุน**:
>
> 1. **Race Condition**
>
>    > ุจูุธูุฑ ุจุณ ูู ุชูููุช ูุนูู.
>    > ูููู ูุจุงู ูุฑุฉ ู10 ูุฃ โ difรญcil ุฌุฏูุง ุชูุฑุงุฑู.
> 2. **Timing Issues**
>
>    > ุชุฑุชูุจ ุงูุชูููุฐ ูุด ุซุงุจุช โ ูู Run ูุฎุชูู.
> 3. **Synchronization Bugs**
>
>    > ูู ูุณูุชู Lock ุฃู ุญุทูุชู Lock ุบูุท โ ุงูุจุฑูุงูุฌ ููููุฌ ุฃู ูุญุตู Deadlock.
> 4. **Interleaving**
>
>    > ุตุนุจ ุชุนุฑูู ููู Thread ูููุฐ ุฅูู ุงูุฃูู.
>
> ุนุดุงู ูุฏูุ ุงุฎุชุจุงุฑ ุจุฑุงูุฌ Multithreaded ุจูููู ุฃุตุนุจ ุจูุชูุฑ ูู Single-threaded.

---

## **4. Multithreading Models**

## **4.1 Types of Threads**

ููู ููุนูู ุฃุณุงุณููู ูู ุงูู Threads ุฏุงุฎู ุฃู ูุธุงู ุชุดุบูู:

---

### **4.1.1 User Threads**

ุฏู ุงูู threads ุงููู ุจูุชู ุฅูุดุงุคูุง ูุงุฏุงุฑุชูุง ูู ุทุฑู ุงูู **user-level libraries**ุ ูุด ูู ุงูู kernel.

##### **ููู ุงุณููู User Threadsุ**

ูุฃู ุงูู **kernel ูุด ุดุงูููู ุฃุตูุงู**. ูู ูุฌูุฉ ูุธุฑ ุงูู kernel:
"ููู Process ูุงุญุฏุฉ ุจุณ"ุ ุฌูุงูุง user threads ุจุชุชุญุฑู ูุชุชูููุฐ.

##### **ูููุฒุงุชูุง**

* ุณุฑูุนุฉ ุฌุฏูุง ูู ุงูุฅูุดุงุก ูุงูู switching.
* ูุด ูุญุชุงุฌุฉ system calls ูุชูุฑ.

##### **ุนููุจูุง**

* ูู ุญุตู block ูู ุญุงุฌุฉ ูุนููุฉ (ุฒู I/O)ุ ุงููู kernel ููููู ุงูู process ููู โ ูู ุงูู user threads ูุชูู ูุนุงู.

##### **ููุงุญุธุฉ ูููุฉ:**

ุงูู **User Thread ูุงูู ุฅูุง libraries ุชุชุญููู** ูู ุงูุจุฑูุงูุฌ ุนูุดุงู ุชุฏูุฑ ุงูู threads ูู ุบูุฑ ูุง ุชุฏุฎู ุงูู kernel.

---

### **4.1.2 Kernel Threads**

ุงูููุน ุฏู ุจูุชุฏุงุฑ ุจุงููุงูู ูู **ุงูู kernel ููุณู**.

##### **ูุนูู ุฅูู Kernel Threadุ**

ูุนูู ุงูู kernel ุดุงููู ูู execution unit ุญููููุฉ:

* ููู scheduling ุฎุงุต
* ููู priority
* ููู management ูุงูู
* ููุฏุฑ ูุนูู parallelism ุนูู ูุฐุง core

##### **ูููุฒุงุชูุง**

* ุชุฏุนู **parallel execution** ูุนูู.
* ูู Thread ูููุ ุงูุจุงูู ูุจูุชูููุด.

##### **ุนููุจูุง**

* ุชูููุฉ ุดููุฉ โ ุงูู kernel ุจูุชุญููู ุชูููุชูุง.
* ุฅูุดุงุกูุง ู ุงูู switching ุจูููุง ุฃุจุทุฃ ูู user threads.

---
## **4.2 Types of Models**

### **4.2.1 Many-to-One Model**

ูู ุงูู **user threads** ุจุชุชููุฐ ุนูู **kernel thread** ูุงุญุฏ.
ุนููุจู:

* ูููุด parallelism ุนูู Multicore
* ูู kernel thread ุงุชุนููู block โ ุงููู ูุชููู

---<img width="226" height="223" alt="download" src="https://github.com/user-attachments/assets/75c76ebb-321e-4f6c-a54a-ac578aae24d0" />


### **4.2.2 One-to-One Model**

ูู **user thread** ููุงุจูู **kernel thread**.
ูููุฒุงุชู:

* ูุฏุนู parallelism
* ุฃุฏุงุก ุฃูุถู
  ุนููุจู:
* ูููู ูู ุญูุซ ุงูููุงุฑุฏ
<img width="365" height="138" alt="download" src="https://github.com/user-attachments/assets/5fce9421-1a7b-4c2f-bd56-808e741c445e" />


### **4.2.3 Many-to-Many Model**

ุนุฏุฉ **user threads** ุชุฑุชุจุท ุจุนุฏุฏ ุฃูู ุฃู ูุณุงูู ูู **kernel threads**.
ุฏู ุฃูุถู Model ูุฃูู:

* ุจูุฏุนู parallelism
* ุจูุฏู ูุฑููุฉ
* ุจูููู overhead
![download](https://github.com/user-attachments/assets/68df3364-3809-42b9-87df-6cab1a72c08a)



### **4.2.4 Two-Level (Two-Tier) Model**

ุงูู **Two-Level Model** ูู ูุณุฎุฉ ูุญุณููุฉ ูู ุงูู Many-to-Manyุ ูุจูุฌูุน ุจูููู ุจุทุฑููุฉ ุฃูุซุฑ ุชูุธูููุง.

**ููุฑุชู ุจุจุณุงุทุฉ:**

* ุงููุธุงู ุจูุณูุญ ููู user threads ุฅููุง ุชุชุฑุจุท ุจูุฐุง **kernel thread** (ุฒู Many-to-Many).
* ููู ูู ููุณ ุงูููุชุ ููู **ุฎููุท ูุนููุฉ** ุจุชุชุฎุตุต ููุง kernel threads ุซุงุจุชุฉ.

ูุนูู:
ุจุนุถ **user threads** ูุชู **ุฑุจุทูุง ูุจุงุดุฑุฉ** ุจู kernel thread ูุนูู โ ูุฏู ุจูุฏู ุฃุฏุงุก ุฃุนูู ููุนูููุงุช ุงููู ูุญุชุงุฌุฉ ุณุฑุนุฉ ุฃู real-time behavior.
ูููู user threads ุชุงููุฉ ุจุชุดุชุบู ุนุงุฏู ูู ุงููุฌููุนุฉ ุงูุนุงูุฉ โ Flexible ุฒู ุงูู Many-to-Many.

---

### **ููู ุงูู Two-Level Model ูููุฏุ**

* ููุฏุฑ ูุนูู **optimization** ูุนูููุงุช ูุนููุฉ ูุญุชุงุฌุฉ ุณุฑุนุฉ ุฃุนูู.
* ูุณูุญ ุฅู ุฎููุท ุญุณูุงุณุฉ (ุฒู I/O-heavy threads) ุชุชุฑุจุท ุจู kernel threads ุซุงุจุชุฉ.
* ููู ููุณ ุงูููุชุ ููุถู ูู ุจุงูู ุงููุธุงู ูุฌูุฏ ูุฑููุฉ ุงูู many-to-many.

ุงููุชูุฌุฉุ
ูุธุงู ูุชูุงุฒู: ูุด ูุชููุฏ ุฒู ุงูู one-to-oneุ ููุด ูุฑู ุฒูุงุฏุฉ ุนู ุงููุฒูู ุฒู ุงูู many-to-many.

---

## **5. Implicit Threading vs Explicit Threading**

ููุฑุฉ ุงููุณู ุฏู: ุฅู ุงูู developer ูุด ูุงุฒู ูุนูู ูู ุญุงุฌุฉ manual.
ูู ููุนูู:

---

### **5.1 Explicit Threading**



##### **ุนูุจู**

ุฅูู ููุจุฑูุฌ ุจุชุชุญููู workload ูุจูุฑ ุฌุฏูุง ูู ุงูุชูุธููุ ูุฏู ุจูุฒูุฏ bugs.

---

### **5.2 Implicit Threading**

ููุง ุงูู system ุฃู ุงูู framework ูู ุงููู ุจูุชููู ุฅุฏุงุฑุฉ ุงูู threads:

* ููุฑุฑ ูุนูู ูุงู thread
* ููุฒูุน ุงูุดุบู
* ูุนูู synchronization

##### **ููุฑุชู ุงูุฃุณุงุณูุฉ**

"ุณูุจ ุฅุฏุงุฑุฉ ุงูู threads ุนูููุงโฆ ุฅูุช ุฑููุฒ ุนูู ุงูู task ููุณูุง."

---

## **6. Thread Cancellation**

ุฃุญูุงููุง ุนุงูุฒูู ูููู Thread ูุจู ูุง ุชุฎูุต ุดุบููุง ูุฃู ุณุจุจ:

* ูุด ูุญุชุงุฌูู ุงููุชูุฌุฉ ุฎูุงุต
* ุงูู user ูุบู ุงูุนูููุฉ
* ุญุตู timeout

ููู ููุนูู:

---

### **7.1 Asynchronous Cancellation**

ููุง ุงูู Thread ุจุชุชูุชู **ูุฌุฃุฉ ููู ุบูุฑ ุชุญุถูุฑ**.

##### **ุนููุจู**

* ูููู ุชููู ููู ูุงุณูุฉ Lock โ ูุญุตู Deadlock.
* ูููู ุชููู ุจุชุนุฏูู data โ ูุจููุธ ุงูู structure.
* Unsafe ุฌุฏูุง ูู ุฃุบูุจ ุงูุจุฑุงูุฌ.

---

### **7.2 Deferred Cancellation**

ุฏู ุงูุฃูุซุฑ ุฃูุงููุง.
ุงูู Thread ูุด ุจุชุชููู ููุฑูุงโฆ ููู:

* ุจุชูุตู ูููุทุฉ "cancellation point"
* ุชูุฑุฑ ุชุณุชูู ุงูุฅุดุงุฑุฉ
* ุชููู ููุณูุง ุจุฃูุงู

##### **ูููุฒุงุชู**

* ูุฏู ูุฑุตุฉ ููู Thread ุฅููุง:

  * ุชุฎูุต critical section
  * ุชุณูุจ ุงูู lock
  * ุชูุธูู ุงูู resources

ุนุดุงู ูุฏู ูุนุธู ุฃูุธูุฉ ุงูุชุดุบูู ุชูุถูู **deferred cancellation**.


---
## **7. Tasks**

### **Task 1:**

Explain the difference between **one-to-one** and **many-to-one** threading models.

### **Task 2:**

Give two real examples where **responsiveness** is important in multithreaded applications.

### **Task 3:**

List three challenges of **multicore programming**.

---
</p>
